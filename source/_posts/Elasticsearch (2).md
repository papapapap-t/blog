---
category: featTest
excerpt: Elasticsearch是一个开源的分布式搜索和分析引擎，它建立在Apache Lucene库之上。它提供了一个高性能、可伸缩、分布式的全文搜索和分析功能，被广泛用于构建实时搜索、日志分析、数据索引和分析等应用。
tags: [分布式 , 数据库 , 搜索引擎 ] 
title: Elasticsearch 
---
# Elasticsearch

## Elasticsearch与传统数据库的区别

1.  数据存储方式：传统数据库通常使用表格的结构来存储数据，而Elasticsearch使用文档的结构来存储数据。文档是一个自包含的数据单元，使用JSON格式表示，可以灵活地表示复杂的数据结构。
2.  数据查询：传统数据库使用结构化查询语言（SQL）进行查询，而Elasticsearch使用基于Lucene的查询语言（Elasticsearch Query DSL）。Elasticsearch具有强大的全文搜索和分析能力，可以对大规模数据进行快速检索，支持复杂的查询操作。
3.  数据分布和扩展性：传统数据库通常使用主从架构或者分片架构来实现数据的分布和扩展。而Elasticsearch采用分布式架构，可以将数据分布在多个节点上，并自动处理数据的复制和负载均衡，以提高系统的容错性和可扩展性。
4.  数据一致性：传统数据库通常使用ACID（原子性、一致性、隔离性、持久性）事务来保证数据的一致性。而Elasticsearch在分布式环境下，采用了一致性哈希算法和复制机制来保证数据的一致性和可用性，但不支持跨文档的事务操作。
5.  数据处理和分析：传统数据库主要用于事务处理和数据存储，对于大规模数据的搜索、分析和可视化支持相对较弱。而Elasticsearch具有强大的文本分析和聚合功能，适用于全文搜索、日志分析、实时监控等场景。

## Elasticsearch的架构是怎样的？

Elasticsearch的架构是分布式的，采用了基于Lucene的搜索引擎技术，主要包括以下几个组件：

1.  节点（Nodes）：Elasticsearch集群中的每一个服务器实例都称为节点。每个节点都可以独立地处理请求和响应，并具有相同的功能和数据。每个节点都有自己的节点名称，可以通过配置文件或者命令行参数来设置。
2.  索引（Indexes）：Elasticsearch中的索引类似于关系型数据库中的数据库。它是一个逻辑上的命名空间，用于存储一组相关的文档。每个索引都有一个唯一的名称，可以包含多个分片和副本。
3.  分片（Shards）：为了支持大规模的数据存储和查询，Elasticsearch将索引拆分成多个分片存储在不同的节点上。每个分片都是一个独立的Lucene索引，包含一部分文档数据。分片可以水平扩展，可以根据需要增加或减少分片的数量。
4.  副本（Replicas）：为了提高系统的可用性和容错性，Elasticsearch可以将每个分片的副本保存在其他节点上。每个副本都是一个完整的分片拷贝，可以处理读取请求和故障转移。副本的数量可以根据需要进行配置。
5.  客户端（Clients）：Elasticsearch集群通过HTTP或者Java API来接收客户端的请求。客户端可以向任意一个节点发送请求，节点将请求转发给对应的分片或者节点进行处理，并将结果返回给客户端。
6.  搜索和聚合（Search and Aggregations）：Elasticsearch提供了强大的搜索和聚合功能，支持全文搜索、多字段搜索、范围搜索、模糊搜索、聚合分析等。搜索和聚合操作可以在一个或多个索引中进行，可以根据需要添加过滤器、排序规则、分页等参数。
7.  映射和类型（Mappings and Types）：Elasticsearch使用映射来定义文档的结构和属性。每个索引可以包含多个类型，每个类型定义了一组属性和相关的操作。类型已经逐渐被废弃，取而代之的是Index Templates。

## Elasticsearch的倒排索引

倒排索引是一种用于全文搜索的数据结构，它将单词（Term）映射到包含该单词的文档（Document）中。与传统的顺序索引（Forward Index）不同，顺序索引将文档映射到包含的单词中。因此，倒排索引可以更快地对大量文本进行搜索，而且支持复杂的查询和聚合操作。
在Elasticsearch中，每个索引都包含一个或多个分片（Shard），每个分片包含一个倒排索引。当一个文档被索引时，Elasticsearch会对文档中的所有字段进行分词（Tokenize）和过滤（Filter），生成多个单词（Term）。然后将每个单词与其所在的文档映射，形成一个倒排索引。 当进行全文搜索时，Elasticsearch会将查询语句分词并查找包含所有查询单词的文档。

倒排索引是Elasticsearch实现全文搜索的关键。它可以加快搜索速度，并支持复杂的查询和聚合操作。

## Elasticsearch的索引是什么意思？如何创建一个索引？

### 什么是Elasticsearch的索引

索引是一个逻辑上的命名空间，用于存储和组织一组相关的文档。它类似于关系型数据库中的数据库概念。每个索引都有一个唯一的名称，并可以包含多个文档。

### 如何建立索引

使用PUT 命令 + 索引名字 可用尽力一个索引 并可以在尽力索引的时候 使用json的格式传递setting 设置参数书写 mapping 设置索引映射

## 什么是文档(Document)？如何创建一个文档？

### 什么是文档

Elasticsearch中的基本的数据单元 使用json格式存储 相当于数据库中的行 但是相对于数据库更灵活

### 如何建立一个文档

可以是用PUT 命令在一个已经建立的索引中创建一个文档 可用规定文档的字段 同时也可以设置文档的ID 如果不设置则自动生成

## 什么是分片(Shard)和副本(Replica)？它们有什么作用？

### 什么是分片

分片即将索引拆分成多个部分的过程，每个部分都为一个分片，每个分片都有一个单独的倒排索引 ，每个分片都可以在每个节点储存和处理数据 ，分片的数量是建立索引

### 分片的作用

可用提高索引检索的速度和可伸缩性 因为它可以在多个节点进行搜索

### 副本的是什么

副本是对索引中的分片制作一个完全相同的拷贝  副本可用分布在不同的节点中 副本的数量在索引创建时规定

### 副本的作用

增加的数据的冗余 提高了系统的连续性和可用性 当一个节点的出现故障或者宕机 可用自行选择可用的节点进行操作数据 同时也可以提高检索速度 因为可以在多个节点进行并行 搜素

## Elasticsearch中的查询(Query)有哪些类型？

### Match Query

分词匹配 会对字段进行分词进行倒排索引中匹配

### Term Query

精准匹配 通常用于查询keyword字段

### Range Query

用于范围查询 通常匹配字段为数值类型或者日期类型

### Bool Query

多条件匹配

1.  must 条件与条件之间是and关系
2.  should 条件和条件之间是or关系
3.  must\_not 必须不匹配，不参与算分，类似“非”
4.  filter 和must一样最终结果不进行打分

## 什么是Mapping？如何定义一个Mapping

### 什么是Mapping

Mapping 可用设置 文档字段类型 如text keyword类型 或者一些复杂类型 不同的类型可用设置不同的索引方案 提高搜索效率

### 定义一个Mapping

1.  在建立索引的时候进行Mapping 设置
2.  也可以在已建立索引的情况下进行PUT 设置一个Mapping

## 如何保证Elasticsearch 和Mysql的一致性

### 使用Logstash

Logstash是Elasticsearch官方提供的一个数据处理工具，可以用于将MySQL中的数据同步到Elasticsearch中。Logstash支持多种数据源和数据同步方式，例如使用JDBC输入插件从MySQL中读取数据，使用Elasticsearch输出插件将数据写入到Elasticsearch中。

### 使用Elasticsearch JDBC River插件

Elasticsearch JDBC River插件可以将MySQL中的数据同步到Elasticsearch中，类似于Logstash。JDBC River插件的原理是通过轮询或监听MySQL数据库，获取最新的数据并将数据写入到Elasticsearch中。JDBC River插件需要将插件安装到Elasticsearch中，并且配置MySQL的JDBC驱动程序和JDBC URL等参数。

### 公司 es 的集群架构，索引数据大小

ES 集群架构 13 个节点，索引根据通道不同共 20+索引，根据日期，每日递增 20+，索引：10分片，每日递增 1 亿+数据，每个通道每天索引大小控制：150GB 之内。
